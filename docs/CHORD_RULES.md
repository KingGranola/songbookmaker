# 🎵 Songbook Maker - ジャズ理論に基づくコード理論ルール

## 📋 目次

1. [ダイアトニックコード](#ダイアトニックコード)
   - [異名同音の使い分けルール](#異名同音の使い分けルール)
   - [メジャーキー（長調）](#メジャーキー長調)
   - [マイナーキー（短調）](#マイナーキー短調)
2. [コード正規化ルール](#コード正規化ルール)
3. [マイナーキーの機能分類](#マイナーキーの機能分類)
4. [セカンダリードミナント](#セカンダリードミナント)
5. [サブドミナントマイナー](#サブドミナントマイナー)
6. [具体的な例](#具体的な例)

---

## 📚 ダイアトニックコード

### 異名同音（いめいどうおん）の使い分けルール

**参考:** [弾き語りすとLABO - 異名同音の使い分け](https://hikigatarisuto-labo.jp/enharmonic/)

#### 🎵 異名同音とは
**同じ音の高さだが、記譜上の名前が異なる音**のこと。
例: C# = Db, F# = Gb, A# = Bb

#### 📏 基本原則
1. **頭文字重複回避**: ダイアトニックスケールで同じアルファベットは使わない
2. **上行進行では#、下行進行では♭を使用**
3. **五線譜での視認性を重視**

#### 🔍 なぜ重要？
- **楽譜作成時**: 適切でないと五線譜が読みにくくなる
- **他楽器との共有**: 音大出身者やクラシック畑の人が困る
- **市販スコア**: 有名出版社の楽譜は正しいルールに則っている

#### 💡 具体例

**✅ 正しい例 - Fキー:**
```
F, G, A, Bb, C, D, E
```
- 各アルファベット（F,G,A,B,C,D,E）が1回ずつ使用
- IV度 = **Bb**（A#ではない）

**❌ 間違った例 - Fキー:**
```
F, G, A, A#, C, D, E
```
- Aが2回登場してしまう（A, A#）

#### 📊 主要キーの異名同音対応

| キー | I | ii | iii | IV | V | vi | vii° |
|------|---|----|----|-------|---|----|----|
| **C** | C | D | E | F | G | A | B |
| **F** | F | G | A | **Bb** | C | D | E |
| **Bb** | Bb | C | D | **Eb** | F | G | A |
| **Eb** | Eb | F | G | **Ab** | Bb | C | D |
| **Ab** | Ab | Bb | C | **Db** | Eb | F | G |
| **Db** | Db | Eb | F | **Gb** | Ab | Bb | C |
| **Gb** | Gb | Ab | Bb | **Cb** | Db | Eb | F |

#### 🎯 実装における重要ポイント
- **FキーのIV△7 = Bb△7**（A#△7ではない）
- **BbキーのIV△7 = Eb△7**（D#△7ではない）
- **EbキーのIV△7 = Ab△7**（G#△7ではない）

### メジャーキー（長調）

メジャーキーのダイアトニックコードは、**イオニアンモード（自然長音階）の音を使用して構成されるコード**の集まりです。これらはジャズのスタンダードを演奏する上で、最初に学ぶ基本的なコードの種類に含まれます。

| 度数 | 機能 | トライアド | セブンス | 機能記号 |
|------|------|------------|----------|----------|
| I | トニック | C | C△7 | T |
| ii | サブドミナント | Dm | Dm7 | SD |
| iii | **トニック・サブスティテュート** | Em | Em7 | **T sub** |
| IV | サブドミナント | F | F△7 | SD |
| V | ドミナント | G | G7 | D |
| vi | **トニック・サブスティテュート** | Am | Am7 | **T sub** |
| vii° | **ドミナント・サブスティテュート** | Bdim | Bm7(♭5) | **D sub** |

**例:** Cメジャーキー
- **トライアド**: C, Dm, Em, F, G, Am, Bdim
- **セブンス**: C△7, Dm7, Em7, F△7, G7, Am7, Bm7(♭5)

**📝 補足説明:**
- **機能記号**: 「T」（トニック）は安定感があり「元に戻った」「終わった」感じ、「SD」（サブドミナント）はやや不安定で浮遊感がある感じ、「D」（ドミナント）は不安定でトニックへ進行し落ち着きたい感じを示します。
- **iii度 (Em7) と vi度 (Am7)**: これらは主要三和音（トニック、サブドミナント、ドミナント）以外のコードであり、ジャズ理論において**「代理（substitute）」**として機能します。特に、トニックコードの代理として機能することから、「トニック・サブスティテュート」と分類されます。
- **vii度 (Bm7(♭5))**: このコードは、ドミナントコード（V7）と同じ機能を持ち、トニックへの解決を促す性質から**「ドミナント・サブスティテュート」**として分類されます。

### マイナーキー（短調）

マイナーキーのダイアトニックコードは、一般的にエオリアンモード（自然短音階）を基準としますが、ジャズにおいては、より多様なサウンドを表現するために、**ハーモニック・マイナーやメロディック・マイナーなどのスケールから派生するコードも頻繁に利用されます**。

**基準:** エオリアンモード（自然短音階）

| 度数 | 機能 | トライアド | セブンス | 機能記号 |
|------|------|------------|----------|----------|
| i | トニック・マイナー | Am | Am7 | T.m |
| ii° | サブドミナント・マイナー | Bdim | Bm7(♭5) | SD.m |
| ♭III | トニック・マイナー | C | C△7 | T.m |
| iv | サブドミナント・マイナー | Dm | Dm7 | SD.m |
| v | ドミナント | Em | Em7 | D |
| ♭VI | サブドミナント・マイナー | F | F△7 | SD.m |
| ♭VII | **サブドミナント・サブスティテュート** | G | G7 | **SD sub** |

**例:** Aマイナーキー
- **トライアド**: Am, Bdim, C, Dm, Em, F, G
- **セブンス**: Am7, Bm7(♭5), C△7, Dm7, Em7, F△7, G7

**📝 補足説明:**
- **v度 (Em7) と V7**: 自然短音階に基づくv度コード（例: Em7）はドミナント機能を持つとされますが、ジャズにおいては、**より強い解決感（ドミナント・モーション）を得るために、ハーモニック・マイナーから派生するV7コード（例: E7）が頻繁に用いられます**。これは、トニック（i）への半音進行による解決感を強調するためです。
- **♭VII度 (G7)**: 自然短音階の♭VII度であり、サブドミナント・マイナーの代理コードとして機能するとされます。また、特定の文脈では**「スペシャル・ファンクション・ドミナント（S.F.D.）」**の一種、特に**「バックドア・ドミナント」**として、トニックへの解決に用いられることがあります。

---

## 🔧 コード正規化ルール

アプリケーション内でコード名を統一するための変換ルール：

### 1. ハーフディミニッシュ
**入力形式** → **統一形式**
- `C-7-5`, `C-7b5`, `Cmin7b5`, `Cm7b5`, `Ch7` → `Cm7(♭5)`

### 2. マイナーセブンス
**入力形式** → **統一形式**
- `C-7`, `Cmin7` → `Cm7`

### 3. オーギュメント
**入力形式** → **統一形式**
- `C+`, `C#5` → `Caug`

### 4. メジャーセブンス（大文字小文字厳密）
**入力形式** → **統一形式**
- `CM7`, `Cmaj7`, `C^7` → `C△7`

**⚠️ 重要:** `M7`（メジャー）と`m7`（マイナー）は厳密に区別されます。

### 5. 異名同音の文脈依存正規化

**キーに応じて理論的に正しい表記に変換：**

| キー | 入力 | 正規化後 | 理由 |
|------|------|----------|------|
| **F** | `A#` | `Bb` | IV度はBbが正しい（頭文字重複回避） |
| **Bb** | `D#` | `Eb` | IV度はEbが正しい |
| **Eb** | `G#` | `Ab` | IV度はAbが正しい |
| **C#** | `Gb` | `F#` | IV度はF#が正しい |

**実装方法:**
- ダイアトニックコード生成時に異名同音テーブルを参照
- キーごとに定義された正しい音名を使用
- 頭文字重複回避ルールを最優先

---

## 🎵 マイナーキーの機能分類

マイナーキーにおけるコードの機能分類は、ジャズ理論において非常に重要です。

参考: [枡田咲子 - マイナーキーのファンクション](https://sakikomasuda.com/music-theory/diatonic-chord/minor-function/)

### 機能分類

#### 1. トニック・マイナー (T.m)
- **基本**: Im, Im7, Im(maj7), Im6
- **代理**: ♭IIImaj7, ♭IIImaj7(#5), VIm7(♭5)
  - **♭IIImaj7**: ルート音以外の構成音がトニックIm7(9)の構成音に当たる場合があり、トニックの代理として機能することがあります。
  - **VIm7(♭5)**: マイナーキーのダイアトニックコードですが、トニックの代理機能を持つとされます。

#### 2. サブドミナント・マイナー (SD.m)
- **基本**: IVm, IVm7
- **代理**: IIm7(♭5), ♭VImaj7, ♭VII7
  - これらのコードは、**同主長調のサブドミナントから借りてきたコード**であり、機能的にサブドミナント・マイナーとして扱われます。
  - **IIm7(♭5)**: ハーフディミニッシュ - マイナーキーのダイアトニック2番目のコードです。
  - **♭VImaj7**: メジャー7th - マイナーキーのダイアトニック6番目のコードです。
  - **♭VII7**: ドミナント7th - マイナーキーのダイアトニック7番目のコードです。

#### 3. サブドミナント (SD)
- **メロディックマイナー由来**: IV7, IIm7
  - メロディック・マイナー・スケールから導かれるこれらのコードは、サブドミナントとしての機能を持ちます。

#### 4. ドミナント (D)
- **基本**: V7（ハーモニックマイナー由来）, Vm7（ナチュラルマイナー由来）
  - 特に**V7は、トライトーンを含み、トニックへの強い解決感（ドミナント・モーション）を導きます**。
- **代理**: VIIdim7, VIIm7(♭5)
  - **VIIdim7**: ハーモニック・マイナー・スケールのVII度であり、V7の代理としてドミナント機能を持ちます。
  - **VIIm7(♭5)**: メロディック・マイナー・スケールのVII度から導かれるドミナントの代理コードです。

---

## 🌟 セカンダリードミナント

セカンダリードミナントとは、**一時的にダイアトニックコードを「I（トニック）」と見なし、そのIに向けて進行するドミナントコード**のことです。ジャズにおいて頻繁に使用されるノン・ダイアトニックコードです。

### メジャーキー
**対象コード** → **セカンダリードミナント**
- V/ii → A7 (Dmに向かう)
- V/iii → B7 (Emに向かう)
- V/IV → C7 (Fに向かう)
- V/V → D7 (Gに向かう)
- V/vi → E7 (Amに向かう)

### マイナーキー
マイナーキーにおいても、メジャーキーと同様の原理でセカンダリードミナントが使用されます。ここでは、マイナーキーの各ダイアトニックコード（または、その代理コード）を一時的なトニックと見なして、そのI度に対するドミナント7thコードを挿入します。

**対象コード** → **セカンダリードミナント**
- V/♭III → E♭7 (Cに向かう)
- V/iv → G7 (Dmに向かう)
- V/v → A7 (Emに向かう)
- V/♭VI → B♭7 (Fに向かう)
- V/♭VII → C7 (Gに向かう)

---

## 🎹 サブドミナントマイナー

### マイナーキーでのサブドミナントマイナー

サブドミナント・マイナーは、**同主長調の曲中に出現するサブドミナントのコードを、平行調（マイナーキー）から借りてきたコードとして扱う概念**です。転調を伴わないものの、一時的にマイナー調のような響きをもたらし、特にトニック・マイナーへの進行を準備する役割を担います。

#### 構成コード
サブドミナント・マイナーとして機能する主なコードは以下の通りです:
1. **IVm7** - 基本のサブドミナントマイナーコードです。
2. **IIm7(♭5)** - ハーフディミニッシュコードであり、SD.mの代理として機能します。
3. **♭VImaj7** - メジャー7thコードであり、SD.mの代理として機能します。
4. **♭VII7** - ドミナント7thコードであり、SD.mの代理として機能します。

#### 機能
- **同主長調からの借用**: サブドミナント・マイナーコードは、**メジャーキーの曲中で、その同主調（平行マイナーキー）にあるサブドミナントの働きを持つコード**として現れます。これにより、曲のトニックは変わらないものの、マイナーキーのようなニュアンスや浮遊感を生み出します。
- **前ドミナント機能**: これらのコードは、トニック・マイナー（T.m）に向かう準備和音として機能し、ジャズのコード進行で頻繁に用いられる**「T.m ← SD.m ← D」**の流れの一部を形成します。

---

## 📖 具体的な例

### Cメジャーキーの場合

**ダイアトニック（セブンス）:**
```
C△7, Dm7, Em7, F△7, G7, Am7, Bm7(♭5)
```
これらのコードはCメジャースケール（イオニアン）の音を3度堆積して作られます。

**セカンダリードミナント:**
```
A7(V/ii), B7(V/iii), C7(V/IV), D7(V/V), E7(V/vi)
```
これらのコードは、本来のダイアトニックコードに先行して一時的なドミナント機能を付与し、解決感を強調するために使用されます。

**サブドミナントマイナー:**
```
Dm7(♭5) (IIm7♭5), Fm7 (IVm7), A♭△7 (♭VImaj7), B♭7 (♭VII7)
```
Cメジャーキーにおいて、これらは同主短調であるCマイナーキーから借りてきたサブドミナント機能を持つコードとして機能します。例えば、Fm7はCマイナーキーのIVm7です。

- **追加補足**: `D♭△7(♭II)` は、Cメジャーキーのサブドミナント・マイナーとしてではなく、**G7（V7）の裏コード（トライトーン・サブスティテューション）**として機能することが一般的です。これはドミナント機能を持つ代理コードです。

### Fメジャーキーの場合（異名同音の例）

**ダイアトニック（セブンス）:**
```
F△7, Gm7, Am7, Bb△7, C7, Dm7, Em7(♭5)
```

**サブドミナントマイナー（同主短調から借用）:**
```
Bbm (IVm), Eb (♭VII), Db△7 (♭VI△7)
```

**重要な異名同音の修正:**
- **IV△7**: **Bb△7**（A#△7ではない）
- **IVm**: **Bbm**（A#mではない）
- **♭VII**: **Eb**（D#ではない）
- **♭VI△7**: **Db△7**（F#△7ではない）

### Bマイナーキーの場合

**ダイアトニック（セブンス）:**
```
Bm7, C#m7(♭5), D△7, Em7, F#m7, G△7, A7
```
これらは自然短音階（エオリアン）のBマイナースケールから導き出されるダイアトニックコードです。

**セカンダリードミナント:**
```
C#7(V/F#m7:V/v), F#7(V/Bm7:V/i)
```
マイナーキーの場合、ドミナントコード自体がV7（ハーモニックマイナー由来）になることが多いように、セカンダリードミナントもより強い解決感を持つV7形が用いられます。この場合、V/♭III は E♭7 (Cに向かう), V/iv は G7 (Dmに向かう), V/v は A7 (Emに向かう), V/♭VI は B♭7 (Fに向かう), V/♭VII は C7 (Gに向かう) となります。

**サブドミナントマイナー（SD.m）:**
```
Em7 (IVm7), C#m7(♭5) (IIm7♭5), G△7 (♭VImaj7), A7 (♭VII7)
```
Bマイナーキーにおけるサブドミナント・マイナーコードは、その同主長調であるBメジャーキーのサブドミナントから借りてきたコードとして、またはマイナーキーのダイアトニックコードの一部として機能します。

---

## 🔗 参考文献

1. **弾き語りすとLABO** - [異名同音の使い分け](https://hikigatarisuto-labo.jp/enharmonic/)
2. **枡田咲子** - [マイナー・キーのダイアトニック・コードのファンクション](https://sakikomasuda.com/music-theory/diatonic-chord/minor-function/)
3. **OTO×NOMA** - [コード理論カリキュラム](https://kensukeinage.com/special/chordtheory/#anc2-1)

---

## 📝 更新履歴

- **v0.5.0** - 初回作成
- **v0.5.0** - 枡田咲子氏の理論に基づくサブドミナントマイナー実装
- **v0.5.0** - コード正規化ルールの大文字小文字厳密化
- **v0.5.0** - 異名同音の使い分けルール実装（弾き語りすとLABO参考）
- **v0.5.0** - 頭文字重複回避による正しいダイアトニックコード生成
- **v0.5.0** - ジャズ理論に基づく機能和声の詳細化
- **v0.5.0** - トニック・サブスティテュート、ドミナント・サブスティテュート概念の追加
- **v0.5.0** - ハーモニック・マイナー、メロディック・マイナー由来コードの説明追加

---

*このドキュメントは Songbook Maker v0.5 の音楽理論実装を基に作成されています。*
