# SONGBOOK MAKER 仕様書 (ver0.3)

## 概要
弾き語り向けのA4サイズ歌詞＋コードネーム一体型歌本メーカー

## 技術仕様

### フロントエンド
- **言語**: HTML5, CSS3, JavaScript (ES6+)
- **モジュール**: ES Modules
- **保存形式**: JSON
- **PDF出力**: ブラウザの印刷機能
- **対応ブラウザ**: Chrome, Safari (推奨)

### ファイル構成
```
songbookmaker/
├── index.html          # メインHTML
├── styles.css          # スタイルシート
├── main.js             # エントリーポイント
├── modules/
│   ├── bootstrap.js    # モジュール初期化
│   ├── state.js        # 状態管理
│   ├── ui.js          # UI制御
│   ├── placement.js   # コード配置・レンダリング
│   └── presets.js     # プリセット生成
├── README.md           # ドキュメント
└── SPECIFICATION.md    # 仕様書
```

## 機能仕様

### 1. 歌詞エディット機能
- **入力方式**: テキストエリア
- **改行処理**: 改行で行分割
- **セクション追加**: [Intro], [Interlude], [Outro], [Bridge]
- **行数削減**: 25文字制限付き行結合
- **Undo機能**: 最大10回の履歴保持

### 2. コード配置機能
- **配置方式**: クリック配置
- **ドラッグ移動**: Pointer Events対応
- **編集機能**: ダブルクリック編集
- **削除機能**: 消しゴムモード
- **区切り線**: 「｜」記号配置

### 3. プリセットコード機能
- **ダイアトニックコード**: メジャー/マイナースケール対応
- **セカンダリードミナント**: V/ii, V/iii, V/IV, V/V, V/vi
- **サブドミナントマイナー**: iv, bVII, bIIImaj7
- **和音タイプ**: 3和音/4和音選択

### 4. 履歴機能
- **表示方式**: 右追加方式
- **最大保持数**: 16個
- **重複除去**: 自動重複除去
- **更新タイミング**: コード配置時

### 5. 表示設定機能
- **フォント選択**: 6種類（明朝/ゴシック/等幅/丸ゴシック/楷書/太字ゴシック）
- **サイズ調整**: 歌詞10-28px、コード10-28px
- **色設定**: コード色カスタマイズ
- **行間調整**: 0-24px
- **コード位置**: -40px〜0px

### 6. データ管理機能
- **自動保存**: ローカルストレージ
- **手動保存**: JSON形式エクスポート
- **読み込み**: JSON形式インポート
- **プロジェクト情報**: タイトル、アーティスト、作曲者

### 7. PDF出力機能
- **サイズ**: A4縦
- **マージン**: 15mm
- **品質**: プレビューと完全一致
- **印刷設定**: ブラウザ標準印刷

## データ構造

### プロジェクトデータ
```json
{
  "version": 1,
  "project": {
    "key": "C",
    "mode": "major",
    "presetType": "triad",
    "lyrics": "歌詞テキスト",
    "lineGap": 8,
    "fontSizeLyrics": 16,
    "fontSizeChord": 14,
    "chordColor": "#b00020",
    "lyricsFontFamily": "sans",
    "chordFontFamily": "sans",
    "marginMm": 15,
    "history": ["C", "G", "Am"],
    "title": "曲名",
    "artist": "アーティスト名",
    "composer": "作曲者名",
    "chords": [
      [
        {"raw": "C", "x": 10},
        {"raw": "G", "x": 50}
      ]
    ]
  }
}
```

### 状態管理
```javascript
const state = {
  key: 'C',
  mode: 'major',
  lyrics: '',
  fontSizeLyrics: 16,
  fontSizeChord: 14,
  chordColor: '#b00020',
  marginMm: 15,
  lineGap: 8,
  selectedChord: null,
  history: [],
  lyricsHistory: [],
  lyricsFontFamily: 'sans',
  chordFontFamily: 'sans',
  title: '',
  artist: '',
  composer: '',
  presetType: 'triad',
  chordOffsetPx: -18
};
```

## レイアウト仕様

### グリッドレイアウト
- **left-panel**: 0.95fr (最大幅600px)
- **right-panel**: 1fr
- **間隔**: 0px
- **パディング**: 16px

### レスポンシブ対応
- **デスクトップ**: 2カラムレイアウト
- **モバイル**: 1カラムレイアウト
- **印刷**: プレビュー専用表示

## 印刷仕様

### 印刷CSS
```css
@media print {
  @page { size: A4 portrait; margin: 0; }
  .page { 
    transform: none !important; 
    width: 210mm !important;
    height: 297mm !important;
  }
  .page-content { padding: 15mm !important; }
}
```

### 印刷品質
- **解像度**: ブラウザ標準
- **フォント**: システムフォント
- **色**: グレースケール対応
- **サイズ**: A4縦固定

## パフォーマンス仕様

### メモリ使用量
- **履歴**: 最大16個
- **歌詞履歴**: 最大10個
- **ローカルストレージ**: 5MB制限

### 処理速度
- **レンダリング**: リアルタイム
- **保存**: 自動保存（変更時）
- **読み込み**: 即座反映

## セキュリティ仕様

### データ保護
- **ローカル保存**: ブラウザ内のみ
- **外部通信**: なし
- **ファイル操作**: ユーザー操作のみ

### プライバシー
- **データ収集**: なし
- **トラッキング**: なし
- **外部送信**: なし

## 互換性仕様

### ブラウザ対応
- **Chrome**: 完全対応
- **Safari**: 完全対応
- **Firefox**: 基本対応
- **Edge**: 基本対応

### デバイス対応
- **デスクトップ**: 完全対応
- **タブレット**: 基本対応
- **スマートフォン**: 制限対応

## 更新履歴

### ver0.3 (2025年8月)
- PDF書き出し精度向上
- 履歴管理改善（右追加方式）
- フォント選択拡充（6種類）
- レイアウト最適化
- 行数削減機能追加
- セクション追加機能改善
- コード編集機能追加

### ver0.2 (2025年8月)
- PDF書き出し位置ずれ修正
- マイナースケールプリセット修正
- コード編集機能追加
- セクション追加機能追加

### ver0.1 (2024年12月)
- 初回リリース
- 基本機能実装
