<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="弾き語り向け A4サイズの歌詞＋コードネームが一体になった歌本メーカー" />
    <meta name="keywords" content="楽譜, コード, 歌詞, 弾き語り, ギター, ピアノ" />
    <title>Songbook Maker - 歌本メーカー</title>
    
    <!-- PWA マニフェスト -->
    <link rel="manifest" href="./manifest.json" />
    <meta name="theme-color" content="#3b82f6" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Songbook Maker" />
    
    <!-- アイコン -->
    <link rel="icon" type="image/svg+xml" href="./icons/favicon.svg" />
    <link rel="alternate icon" href="./icons/favicon.svg" />
    <link rel="mask-icon" href="./icons/favicon.svg" color="#3b82f6" />
    <!-- 分割されたCSSファイルを読み込み -->
    <link rel="stylesheet" href="./styles/base.css" />
    <link rel="stylesheet" href="./styles/header.css" />
    <link rel="stylesheet" href="./styles/buttons.css" />
    <link rel="stylesheet" href="./styles/layout.css" />
    <link rel="stylesheet" href="./styles/editor.css" />
    <link rel="stylesheet" href="./styles/preview.css" />
    <link rel="stylesheet" href="./styles/dialog.css" />
    <link rel="stylesheet" href="./styles/print.css" />
    <link rel="stylesheet" href="./styles/responsive.css" />
    <link rel="stylesheet" href="./styles/mobile.css" />
    <link rel="stylesheet" href="./styles/accessibility.css" />
  </head>
  <body>
    <header class="app-header" role="banner">
      <div class="brand">
        <h1>SONGBOOK MAKER</h1>
        <span class="version-badge" title="バージョン 0.5" aria-label="バージョン 0.5">v0.5</span>
      </div>
      <div class="toolbar" role="toolbar" aria-label="メインツールバー">
        <button id="btn-print" class="primary" aria-label="PDF書き出し" title="現在の楽譜をPDFとして書き出します (Ctrl+P)">
          <span aria-hidden="true">📄</span> PDF書き出し
        </button>
        <button id="btn-save" class="ghost" aria-label="プロジェクトを保存" title="現在の作業をJSONファイルとして保存します (Ctrl+S)">
          <span aria-hidden="true">💾</span> 保存
        </button>
        <button id="btn-load" class="ghost" aria-label="プロジェクトを読み込み" title="保存されたJSONファイルを読み込みます (Ctrl+O)">
          <span aria-hidden="true">📁</span> 読み込み
        </button>
        <input id="file-input" type="file" accept="application/json" style="display:none" aria-label="ファイル選択" />
      </div>
    </header>

    <main class="app-main" role="main">
      <section class="left-panel" aria-labelledby="editor-heading">
        <h2 id="editor-heading">Editor</h2>
        <div class="meta-row" role="group" aria-label="楽曲情報">
          <label class="field">
            <span>タイトル</span>
            <input id="title-input" type="text" placeholder="曲名" aria-label="楽曲タイトル" aria-required="true" />
          </label>
          <label class="field">
            <span>アーティスト</span>
            <input id="artist-input" type="text" placeholder="アーティスト名" aria-label="アーティスト名" aria-required="true" />
          </label>
          <label class="field">
            <span>作曲者</span>
            <input id="composer-input" type="text" placeholder="作曲者名" aria-label="作曲者名" />
          </label>
        </div>
        <label for="lyrics-input" class="visually-hidden">歌詞入力</label>
        <textarea 
          id="lyrics-input" 
          placeholder="ここに歌詞を貼り付け/入力してください。改行で行が分割されます。" 
          aria-label="歌詞テキスト"
          aria-describedby="lyrics-help"
        ></textarea>
        <div id="lyrics-help" class="visually-hidden">歌詞を入力してください。改行で行が分割されます。</div>
        <div class="helpers">
          <button id="btn-clear" class="ghost">歌詞をクリア</button>
          <button id="btn-reduce-lines" class="ghost">行を減らす</button>
          <button id="btn-undo" class="ghost">元に戻す</button>
        </div>

        <div class="palette">
          <div class="palette-row">
            <div class="palette-title">キー</div>
            <div class="chip-row">
              <label class="field"><span>ルート</span>
                <select id="key-select" aria-label="キー選択">
                  <option value="C">C</option>
                  <option value="D">D</option>
                  <option value="E">E</option>
                  <option value="F">F</option>
                  <option value="G">G</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="Bb">Bb</option>
                  <option value="Cb">Cb</option>
                  <option value="C#">C#</option>
                  <option value="Db">Db</option>
                  <option value="Eb">Eb</option>
                  <option value="F#">F#</option>
                  <option value="Ab">Ab</option>
                  <option value="Gb">Gb</option>
                </select>
              </label>
              <label class="field"><span>調</span>
                <select id="mode-select" aria-label="モード選択">
                  <option value="major">メジャー</option>
                  <option value="minor">マイナー</option>
                </select>
              </label>
              <label class="field"><span>和音</span>
                <select id="preset-type" aria-label="プリセットの和音タイプ">
                  <option value="triad">3和音</option>
                  <option value="seventh">4和音</option>
                </select>
              </label>
            </div>
          </div>
          <div class="palette-row">
            <div class="palette-title">履歴</div>
            <div id="history-list" class="chip-row"></div>
          </div>
          <div class="palette-row">
            <div class="palette-title">プリセット</div>
            <div id="preset-list" class="chip-row"></div>
            <div class="chip-row">
              
            </div>
          </div>
          <div class="palette-row">
            <div class="palette-title">セクション</div>
            <div class="chip-row">
              <button class="section-chip" data-section="INTRO">INTRO</button>
              <button class="section-chip" data-section="A">A</button>
              <button class="section-chip" data-section="B">B</button>
              <button class="section-chip" data-section="C">C</button>
              <button class="section-chip" data-section="CHORUS">CHORUS</button>
              <button class="section-chip" data-section="BRIDGE">BRIDGE</button>
              <button class="section-chip" data-section="SOLO">SOLO</button>
              <button class="section-chip" data-section="OUTRO">OUTRO</button>
            </div>
          </div>

          <div class="palette-row">
            <input id="custom-chord" type="text" placeholder="カスタムコード (例: G7, F#m7b5, C/E)" />
            <button id="btn-set-custom">選択中コードに設定</button>
            <button id="btn-sep" class="chip" title="区切り線">｜</button>
            <button id="btn-eraser" class="danger ghost" style="display: none;">消しゴム</button>
            <button id="btn-edit-mode" class="ghost" title="編集モード切り替え" style="display: none;">編集モード</button>
          </div>

        </div>
      </section>

      <section class="right-panel">
        <h2>Preview</h2>
        <div class="right-content">
          <div class="preview-wrap">
            <div id="page" class="page a4 portrait" aria-label="A4プレビュー">
              <div id="page-content" class="page-content"></div>
            </div>
          </div>
          <div class="right-sidebar">
            <div class="current-chord-display">
              <div class="current-chord-value" id="current-chord">なし</div>
            </div>
            <aside class="right-controls">
              <div class="ctrl-title">表示設定</div>
              <label class="field"><span>歌詞フォント</span>
                <select id="lyrics-ff">
                  <option value="sans" selected>ゴシック</option>
                  <option value="serif">明朝</option>
                  <option value="rounded">丸ゴシック</option>
                </select>
              </label>
              <label class="field"><span>歌詞サイズ</span><input id="lyrics-font" type="range" min="10" max="28" value="16" /></label>
              <label class="field"><span>行間</span><input id="lyrics-leading" type="range" min="0" max="24" value="8" /></label>
              <label class="field"><span>字間</span><input id="letter-spacing" type="range" min="-2" max="8" value="0" /></label>
              <label class="field"><span>行全体右位置</span><input id="line-offset" type="range" min="0" max="100" value="0" /></label>
              <div style="width: 100%; height: 1px; background: var(--border); margin: 8px 0;"></div>
              <label class="field"><span>コードフォント</span>
                <select id="chord-ff">
                  <option value="sans" selected>ゴシック</option>
                  <option value="serif">明朝</option>
                  <option value="rounded">丸ゴシック</option>
                </select>
              </label>
              <label class="field"><span>コードサイズ</span><input id="chord-font" type="range" min="10" max="28" value="14" /></label>
              <label class="field"><span>コード色</span><input id="chord-color" type="color" value="#b00020" /></label>
              <label class="field"><span>コード縦位置</span><input id="chord-offset" type="range" min="-40" max="0" value="-18" /></label>
              <div style="width: 100%; height: 1px; background: var(--border); margin: 8px 0;"></div>
              <button id="btn-eraser-controls" class="ghost" style="width: 100%; margin-bottom: 4px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
                  <path d="M15.14,3C14.63,3 14.12,3.2 13.73,3.59L2.59,14.73C1.81,15.5 1.81,16.73 2.59,17.5L6.5,21.41C7.27,22.19 8.5,22.19 9.27,21.41L20.41,10.27C21.19,9.5 21.19,8.27 20.41,7.5L16.5,3.59C16.11,3.2 15.6,3 15.14,3M17,6L21,10L15,16L11,12L17,6M7,18L9,20L6,23L4,21L7,18Z"/>
                </svg>
                消しゴムモード
              </button>
              <button id="btn-edit-mode-controls" class="ghost" style="width: 100%;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
                  <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/>
                </svg>
                編集モード
              </button>
            </aside>
          </div>
        </div>
      </section>
    </main>

    

    <footer class="app-footer">
      <div>2025 SONGBOOK MAKER</div>
    </footer>

    <script type="module" src="./main.js"></script>
    
    <!-- Service Worker 登録 -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then((registration) => {
              console.log('SW registered: ', registration);
              
              // アップデート検出
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // 新しいバージョンが利用可能
                    if (confirm('新しいバージョンが利用可能です。更新しますか？')) {
                      newWorker.postMessage({ type: 'SKIP_WAITING' });
                      window.location.reload();
                    }
                  }
                });
              });
            })
            .catch((registrationError) => {
              console.log('SW registration failed: ', registrationError);
            });
        });

        // Service Worker の制御変更を監視
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          window.location.reload();
        });
      }
    </script>
  </body>
  </html>


